!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).Virtual=n()}(this,(function(){"use strict"
var t=function(){function t(){this.eventList={}}return t.prototype.setRegisterInterpreter=function(t){this.regi=t},t.prototype.setUnregisterInterpreter=function(t){this.uregi=t},t.prototype.addEventListener=function(t,n){return this.eventList[t]||(this.eventList[t]=[]),this.eventList[t].push(n),!!this.regi&&this.regi(t,n)},t.prototype.removeEventListener=function(t,n){return!!this.uregi&&this.uregi(t,n)},t.prototype.unload=function(){var t=!0,n=function(n){if(e.eventList[n]){var i=e
e.eventList[n].forEach((function(e){i.uregi(n,e)||(t=!1)}))}},e=this
for(var i in this.eventList)n(i)
return this.eventList={},t},t}(),n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,e)}
var e=function(t){function e(n){var e=t.call(this)||this
return e.element=n,t.prototype.setRegisterInterpreter.call(e,e.registerInterpreter),t.prototype.setUnregisterInterpreter.call(e,e.unregisterInterpreter),e}return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.registerInterpreter=function(t,n){return this.element.addEventListener(t,n),!0},e.prototype.unregisterInterpreter=function(t,n){return this.element.removeEventListener(t,n),!0},e.prototype.unload=function(){return t.prototype.unload.call(this)},e}(t)
function i(n){return new t}function r(t){return"object"==typeof(n=t)&&null!==n&&1===n.nodeType&&"string"==typeof n.nodeName&&new e(t)
var n}var o=function(){function t(t){this.listenerList=new Map,this.type="ListenerLauncher",this.elementConstructor=t}return t.prototype.for=function(t){if(!this.listenerList.has(t)){var n=this.elementConstructor(t)
if("boolean"==typeof n)return null
this.listenerList.set(t,n)}return this.listenerList.get(t)},t.prototype.unload=function(){var t=!0
return this.listenerList.forEach((function(n){n.unload()||(t=!1)})),t},t}(),s={load:function(t,n){var e=document.createElement("script"),i=document.getElementsByTagName("head")[0]
e.onload=function(){n(e)},e.src=t,i.appendChild(e)},unload:function(t,n){return document.getElementsByTagName("head")[0].removeChild(n),!0}},u={load:function(t,n){var e=document.createElement("link"),i=document.getElementsByTagName("head")[0]
e.onload=function(){n(e)},e.rel="stylesheet",e.href=t,i.appendChild(e)},unload:function(t,n){return document.getElementsByTagName("head")[0].removeChild(n),!0}},c=function(){function t(t){this.loaded=new Map,this.loadFunction=t.load,this.unloadFunction=t.unload}return t.prototype.loadItem=function(t,n){var e=this
this.loadFunction(t,(function(i){return("boolean"!=typeof i||!1!==i)&&(e.loaded.set(t,i),!n||n(i))}))},t.prototype.unloadItem=function(t){var n=this
if("string"==typeof t){var e=this.loaded.get(t)
return!!e&&this.unloadFunction(t,e)}var i=Object.keys(this.loaded).find((function(e){return n.loaded[e]===t}))
return!!i&&this.unloadFunction(i,t)},t.prototype.unload=function(){var t=this,n=!0
return this.loaded.forEach((function(e,i){t.unloadFunction(i,e)||(n=!1)})),this.loaded.clear(),n},t}(),a=function(){function t(t){this.element=t,this.li=new o(r),this.scriptLoader=new c(s),this.styleLoader=new c(u)}return t.prototype.unload=function(){return this.li.unload()&&this.scriptLoader.unload()&&this.styleLoader.unload()},t}(),l=function(){function t(t){this.node=t.cloneNode(!0)}return t.prototype.restore=function(){return this.node},t}(),h=function(){function t(t){this.isRunning=!1,this.extraFunctions=[],void 0!==t&&t.predefinedClasses?this.constructElement(!0):this.constructElement(!1),this.$=new a(this.htmlElement)}return t.prototype.loadHTML=function(t,n){var e=this,i=new XMLHttpRequest
i.onload=function(t){return e.htmlElement.innerHTML=i.responseText,!n||n(i)},i.open("GET",t),i.send()},t.prototype.enableEnvironment=function(){if(this.backup)throw new Error("Environment already enabled")
this.backup=new l(this.htmlElement)},t.prototype.restoreEnvironment=function(){if(!this.backup)throw new Error("No Environment was created.")
var t=this.backup.restore()
this.containerElement.innerHTML="",this.containerElement.appendChild(t),this.htmlElement=this.containerElement.getElementsByTagName("div")[0],this.deleteBackup(),this.$.element=this.htmlElement},t.prototype.setEnvironment=function(t){if("function"!=typeof t||this.isRunning)throw new Error("createEnvironment only accepts functions")
return this.envFunction=t,!0},t.prototype.runEnvironment=function(){return"function"==typeof this.envFunction&&!this.isRunning&&(this.enableEnvironment(),this.envFunction(this.$),this.isRunning=!0,!0)},t.prototype.createEnvironment=function(t){if("function"!=typeof t||this.isRunning)throw new Error("createEnvironment only accepts functions")
return this.enableEnvironment(),this.envFunction=t,this.envFunction(this.$),this.isRunning=!0,!0},t.prototype.addEnvironment=function(t){if("function"==typeof t&&this.isRunning){var n=this.extraFunctions.push(t)
return this.extraFunctions[n-1](this.$),!0}return!1},t.prototype.deleteBackup=function(){this.backup=void 0},t.prototype.removeEnvFunc=function(){this.extraFunctions=[],this.envFunction=null},t.prototype.reset=function(){return this.unload()},t.prototype.unload=function(){return this.removeEnvFunc(),this.isRunning=!1,this.restoreEnvironment(),this.$.unload()},t.prototype.constructElement=function(t){this.containerElement=document.createElement("div"),this.htmlElement=document.createElement("div"),t&&(this.containerElement.classList.add("virtualContainer"),this.htmlElement.classList.add("virtualElement")),this.containerElement.appendChild(this.htmlElement)},t}()
return function(){function n(){throw new Error("Virtual namespace is not for constructing")}return n.Site=h,n.Tool=a,n.Loader=c,n.BasicListener=t,n.ElementListener=e,n.ListenerLauncher=o,n.LoaderItem={Script:s,Style:u},n.ListenerLauncherItem={ElementListenerCreation:r,BasicListenerCreation:i},n}()}))
